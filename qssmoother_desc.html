<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>API Reference: Filters for signal smoothing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/kmilo17pet/qlibs" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="qlibs_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">API Reference
   &#160;<span id="projectnumber">v1.2</span>
   </div>
   <div id="projectbrief">A collection of useful libraries for embedded systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('qssmoother_desc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Filters for signal smoothing </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#qssmoother_lpf1">First Order Low Pass Filter</a><ul><li class="level2"><a href="#qssmoother_ex1">Example: setting up a 1st order low-pass filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_lpf2">Second Order Low Pass Filter</a><ul><li class="level2"><a href="#qssmoother_ex2">Example: setting up a 2nd order low-pass filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_mwm1">Moving Window Median Filter O(n)</a><ul><li class="level2"><a href="#qssmoother_ex3">Example: setting up a moving window median filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_mwm2">Moving Window Median Filter O(1)</a><ul><li class="level2"><a href="#qssmoother_ex4">Example: Setting up a moving window median filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_mor1">Moving Outlier Removal Filter O(n)</a><ul><li class="level2"><a href="#qssmoother_ex5">Example: setting up an outlier removal filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_mor2">Moving Outlier Removal Filter O(1)</a><ul><li class="level2"><a href="#qssmoother_ex6">Example: setting up an outlier removal filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_gmwf">Gaussian Filter</a><ul><li class="level2"><a href="#qssmoother_ex7">Example: setting up a gaussian filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_expw">Exponential Weighting filter</a><ul><li class="level2"><a href="#qssmoother_ex8">Example: setting up an exponential weighting filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_klmn">Scalar Kalman filter</a><ul><li class="level2"><a href="#qssmoother_ex9">Example: setting up a scalar Kalman filter:</a></li>
</ul>
</li>
<li class="level1"><a href="#qssmoother_desf">Double Exponential Smoothing</a></li>
<li class="level1"><a href="#qssmoother_alnf">Adaptive Linear Filter</a></li>
<li class="level1"><a href="#qssmoother_ex10">Example of signal smoothing</a></li>
</ul>
</div>
<div class="textblock"><p >In many embedded systems applications, signals are captured and may be subject to "noise." To reconstruct the original signal, a "smoothing filter" is applied to "clear" the signal of this noise. The filter attenuates high frequency components and emphasizes slow changes in values, making trends easier to discern. The qLibs library offers the qSSMoother module, which includes a collection of commonly used and efficient smoothing filters for easy signal processing.</p>
<p >Below is the list of filters supported by <a class="el" href="group__qssmoother.html">qSSMoother</a> :</p>
<h1><a class="anchor" id="qssmoother_lpf1"></a>
First Order Low Pass Filter</h1>
<p >A first-order low-pass filter passes signals with a frequency lower than a chosen cutoff frequency and reduces signals with frequencies higher than the cutoff. This results in a smoother signal by removing short-term fluctuations and highlighting longer-term trends. The discrete-time equation of this filter is defined as follows, where \(w\) is the cut-off frequency given in \(rad/seg\)</p>
<p >The difference-equation of the output of this filter is given by:</p>
<center> \(y(t)=x(t)+\alpha[y(t-1)+x(t)]\) </center><p >where,</p>
<center> \(\alpha=e^{-T_{m}w}\) </center><center> \( 0 &lt; \alpha &lt; 1\) </center><h2><a class="anchor" id="qssmoother_ex1"></a>
Example: setting up a 1st order low-pass filter:</h2>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structq_s_smoother___l_p_f1__t.html">qSSmoother_LPF1_t</a> smoother;</div>
<div class="line"><span class="keywordtype">float</span> alpha = 0.85f;</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ad67f57dd9afcfa9a0a6803aa92a616ea">QSSMOOTHER_TYPE_LPF1</a>, &amp;alpha, NULL, 0u );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gae494958fd1353a8cd956e35abd6641f7"><div class="ttname"><a href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a></div><div class="ttdeci">int qSSmoother_Setup(qSSmootherPtr_t *const s, const qSSmoother_Type_t type, const float *const param, float *window, const size_t wsize)</div><div class="ttdoc">Setup an initialize smoother filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.c:89</div></div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639ad67f57dd9afcfa9a0a6803aa92a616ea"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ad67f57dd9afcfa9a0a6803aa92a616ea">QSSMOOTHER_TYPE_LPF1</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_LPF1</div><div class="ttdef"><b>Definition:</b> qssmoother.h:29</div></div>
<div class="ttc" id="astructq_s_smoother___l_p_f1__t_html"><div class="ttname"><a href="structq_s_smoother___l_p_f1__t.html">qSSmoother_LPF1_t</a></div><div class="ttdoc">A 1st order Low-Pass Filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:56</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_lpf2"></a>
Second Order Low Pass Filter</h1>
<p >This filter has similar properties to the 1st order low pass filter. The main difference is that the stop band roll-off will be twice the 1st order filters at 40dB/decade (12dB/octave) as the operating frequency increases above the cut-off frequency \(w\).</p>
<p >The difference-equation of the output of this filter is given by:</p>
<center> \(y(t)=kx(t)+b_{1}x(t-1)+kx(t-2)-a_{1}y(t-1)-a_{2}y(t-2)\) </center><p >where,</p>
<center> \( 0 &lt; \alpha &lt; 1\)</center><center> \(p=\sqrt{2\alpha}\), \(r=1+p+\alpha^{2}\), \(k=\frac{\alpha^{2}}{r}\)</center><center> \(a_1=\frac{ 2(\alpha^{2}-1)}{r}\), \(a_2=\frac{ 1-p+\alpha^{2} }{r}\), \(b_1=2k\) </center><h2><a class="anchor" id="qssmoother_ex2"></a>
Example: setting up a 2nd order low-pass filter:</h2>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structq_s_smoother___l_p_f2__t.html">qSSmoother_LPF2_t</a> smoother;</div>
<div class="line"><span class="keywordtype">float</span> alpha = 0.85f;</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a3247b5a5622c33af6599c5dfef9f1796">QSSMOOTHER_TYPE_LPF2</a>, &amp;alpha, NULL, 0u );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639a3247b5a5622c33af6599c5dfef9f1796"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a3247b5a5622c33af6599c5dfef9f1796">QSSMOOTHER_TYPE_LPF2</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_LPF2</div><div class="ttdef"><b>Definition:</b> qssmoother.h:30</div></div>
<div class="ttc" id="astructq_s_smoother___l_p_f2__t_html"><div class="ttname"><a href="structq_s_smoother___l_p_f2__t.html">qSSmoother_LPF2_t</a></div><div class="ttdoc">A 2nd order Low-Pass Filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:67</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_mwm1"></a>
Moving Window Median Filter O(n)</h1>
<p >This low-pass filter calculates the moving median of the input signal over time using the sliding window method. A window of a specified length is moved sample by sample and the median of the data in the window is computed.</p>
<p >For each input sample, the output is the median of the current sample and the previous \(N - 1\) samples. \(N\) represents the length of the window in samples To compute the first \(N - 1\) outputs, he algorithm fills the window with the first current sample when there is not enough data yet.</p>
<p >The difference-equation of the output of this filter is given by:</p>
<center> \( \frac{1}{N}\sum_{i=0}^{N-1}y(t-i)=\frac{1}{N}[ y(t) + y(t-1) + ... + y(t-N-1) ] \) </center><p >This filter has a time complexity of \(O(n)\)</p>
<h2><a class="anchor" id="qssmoother_ex3"></a>
Example: setting up a moving window median filter:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define N_MWM     ( 20u )</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structq_s_smoother___m_w_m1__t.html">qSSmoother_MWM1_t</a> smoother; </div>
<div class="line"><span class="keywordtype">float</span> m_window[ N_MWM ] = { 0.0f };</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ac2598cbedb9a3b3b663f3f887be4a342">QSSMOOTHER_TYPE_MWM1</a>, NULL, m_window, N_MWM );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639ac2598cbedb9a3b3b663f3f887be4a342"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ac2598cbedb9a3b3b663f3f887be4a342">QSSMOOTHER_TYPE_MWM1</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_MWM1</div><div class="ttdef"><b>Definition:</b> qssmoother.h:31</div></div>
<div class="ttc" id="astructq_s_smoother___m_w_m1__t_html"><div class="ttname"><a href="structq_s_smoother___m_w_m1__t.html">qSSmoother_MWM1_t</a></div><div class="ttdoc">A Moving Window Median filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:80</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_mwm2"></a>
Moving Window Median Filter O(1)</h1>
<p >This filter operates on the same principle as the previous filter. The main difference is the treatment of the sliding window, which is implemented as a TDL (Tapped Delay Line) using a circular queue. This structure has \(N - 1\) taps in a line of delays, each tap extracts the signal at a fixed integer delay relative to the input.</p>
<p >The circular queue approach prevents the shift of all the \(N - 1\) samples stored in the sliding window.</p>
<dl class="section remark"><dt>Remarks</dt><dd>This implementation offers a significant performance benefit as it has a constant time complexity of \(O(1)\) , compared to the previous filter where time complexity grows proportionally to the size of the window. Use this filter when dealing with large sliding windows.</dd></dl>
<h2><a class="anchor" id="qssmoother_ex4"></a>
Example: Setting up a moving window median filter:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define N_MWM     ( 150u )</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structq_s_smoother___m_w_m2__t.html">qSSmoother_MWM2_t</a> smoother; </div>
<div class="line"><span class="keywordtype">float</span> m_window[ N_MWM ] = { 0.0f };</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ac2598cbedb9a3b3b663f3f887be4a342">QSSMOOTHER_TYPE_MWM1</a>, NULL, m_window, N_MWM );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="astructq_s_smoother___m_w_m2__t_html"><div class="ttname"><a href="structq_s_smoother___m_w_m2__t.html">qSSmoother_MWM2_t</a></div><div class="ttdoc">A Moving Window Median filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:93</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_mor1"></a>
Moving Outlier Removal Filter O(n)</h1>
<p >This filter detects and removes outliers in the input signal by computing the median of a moving window for each sample. If a new incoming sample deviates from the median by a specified margin \(\alpha\), it is replaced by the moving median \(\overline{m(k)} \).</p>
<p >This filter uses the following criteria for outlier removal:</p>
<center> \( y(k) = \overline{m(k)} \rightarrow \text{if} \rightarrow | \overline{m(k)} - x(k) | &gt; \alpha|\overline{m(k)}| \)</center><center> \( \text{else}=x(k) \) </center><p >This filter has a time complexity of \(O(n)\)</p>
<h2><a class="anchor" id="qssmoother_ex5"></a>
Example: setting up an outlier removal filter:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define N_MOR     ( 10u )</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structq_s_smoother___m_o_r1__t.html">qSSmoother_MOR1_t</a> smoother; </div>
<div class="line"><span class="keywordtype">float</span> alpha = 0.8f;</div>
<div class="line"><span class="keywordtype">float</span> m_window[ N_MOR ] = { 0.0f };</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ad4c3e7ec5b54fc155c6a84381f8e29f8">QSSMOOTHER_TYPE_MOR1</a>, &amp;alpha, m_window, N_MOR );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639ad4c3e7ec5b54fc155c6a84381f8e29f8"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ad4c3e7ec5b54fc155c6a84381f8e29f8">QSSMOOTHER_TYPE_MOR1</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_MOR1</div><div class="ttdef"><b>Definition:</b> qssmoother.h:33</div></div>
<div class="ttc" id="astructq_s_smoother___m_o_r1__t_html"><div class="ttname"><a href="structq_s_smoother___m_o_r1__t.html">qSSmoother_MOR1_t</a></div><div class="ttdoc">A Moving Outlier Removal filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:106</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_mor2"></a>
Moving Outlier Removal Filter O(1)</h1>
<p >Similar to the previous filter, but with a constant time complexity of  \(O(1)\) by using a <a class="el" href="group__qtdl.html">qTDL</a> data structure.</p>
<h2><a class="anchor" id="qssmoother_ex6"></a>
Example: setting up an outlier removal filter:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define N_MWM     ( 10u )</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structq_s_smoother___m_o_r2__t.html">qSSmoother_MOR2_t</a> smoother; </div>
<div class="line"><span class="keywordtype">float</span> alpha = 0.8f;</div>
<div class="line"><span class="keywordtype">float</span> m_window[ N_MWM ] = { 0.0f };</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a5679bf69e01eed679eec13883af3d117">QSSMOOTHER_TYPE_MOR2</a>, &amp;alpha, m_window, N_MWM );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639a5679bf69e01eed679eec13883af3d117"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a5679bf69e01eed679eec13883af3d117">QSSMOOTHER_TYPE_MOR2</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_MOR2</div><div class="ttdef"><b>Definition:</b> qssmoother.h:34</div></div>
<div class="ttc" id="astructq_s_smoother___m_o_r2__t_html"><div class="ttname"><a href="structq_s_smoother___m_o_r2__t.html">qSSmoother_MOR2_t</a></div><div class="ttdoc">A Moving Outlier Removal filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:119</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_gmwf"></a>
Gaussian Filter</h1>
<p >This filter uses a kernel for smoothing, which defines the shape of the function that is used to take the average of the neighboring points. A Gaussian kernel has the shape of a Gaussian curve with a normal distribution.</p>
<p >The coefficients of the kernel are computed from the following equation:</p>
<center> \( w(n)=e^{\frac{1}{2}( \alpha\frac{ n }{ (L-1)/2} )^2} = e^{-n^{2}/2\sigma^2 }\) </center><p >were \( -(L-1)/2 \leq n \leq (L-1)/2 \) and \(\alpha\) is inversely proportional to the standard deviation, \(\sigma\), of a Gaussian random variable. The exact correspondence with the standard deviation of a Gaussian probability density function is \( \sigma = (L – 1)/(2\alpha)\) .</p>
<p >This filter has a time complexity of \(O(n)\)</p>
<h2><a class="anchor" id="qssmoother_ex7"></a>
Example: setting up a gaussian filter:</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#define SMOOTHER_WINDOW_SIZE    ( 10 )</span></div>
<div class="line"><span class="preprocessor">#define SMOOTHER_SAMPLE_TIME    ( 100 )</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structq_s_smoother___g_m_w_f__t.html">qSSmoother_GMWF_t</a>  smoother; </div>
<div class="line"><span class="keywordtype">float</span> win_kernel[ 2*SMOOTHER_WINDOW_SIZE ];</div>
<div class="line"><span class="keywordtype">float</span> params[ 2 ] = { 0.5f, SMOOTHER_WINDOW_SIZE/2.0f }; <span class="comment">//sigma and offset</span></div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a0f072f41aec7b912c7e49bf897a0d87b">QSSMOOTHER_TYPE_GMWF</a>,</div>
<div class="line">                        params, win_kernel, <span class="keyword">sizeof</span>(win_kernel)/<span class="keyword">sizeof</span>(win_kernel[0]) );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639a0f072f41aec7b912c7e49bf897a0d87b"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a0f072f41aec7b912c7e49bf897a0d87b">QSSMOOTHER_TYPE_GMWF</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_GMWF</div><div class="ttdef"><b>Definition:</b> qssmoother.h:35</div></div>
<div class="ttc" id="astructq_s_smoother___g_m_w_f__t_html"><div class="ttname"><a href="structq_s_smoother___g_m_w_f__t.html">qSSmoother_GMWF_t</a></div><div class="ttdoc">A Gaussian filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:131</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_expw"></a>
Exponential Weighting filter</h1>
<p >This filter uses a weighting factor that is computed and applied to the input signal in a recursive manner. The weighting factor decreases exponentially as the age of the data increases, but never reaches zero, meaning more recent data has more influence on the current sample than older data</p>
<p >The value of the forgetting factor \(\lambda\) determines the rate of change of the weighting factor. A smaller value (below 0.5) gives more weight to recent data, while a value of 1.0 indicates infinite memory. The optimal value for the forgetting factor depends on the data stream.</p>
<p >The moving average algorithm updates the weight and computes the moving average recursively for each data sample that comes in by using the following recursive equations:</p>
<center> \( w(t) = \lambda w(t-1) + 1 \) </center><center> \( y(t) = ( 1-\frac{1}{w(t)} )y(t-1) + \frac{1}{w(t)}x(t)\) </center><h2><a class="anchor" id="qssmoother_ex8"></a>
Example: setting up an exponential weighting filter:</h2>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structq_s_smoother___e_x_p_w__t.html">qSSmoother_EXPW_t</a>  smoother; </div>
<div class="line"><span class="keywordtype">float</span> lambda = 0.8f;</div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a3113bceea7e0aed76fd9885b0bdaf135">QSSMOOTHER_TYPE_EXPW</a>, &amp;lambda, NULL, 0u );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639a3113bceea7e0aed76fd9885b0bdaf135"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a3113bceea7e0aed76fd9885b0bdaf135">QSSMOOTHER_TYPE_EXPW</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_EXPW</div><div class="ttdef"><b>Definition:</b> qssmoother.h:37</div></div>
<div class="ttc" id="astructq_s_smoother___e_x_p_w__t_html"><div class="ttname"><a href="structq_s_smoother___e_x_p_w__t.html">qSSmoother_EXPW_t</a></div><div class="ttdoc">An Exponential weighting filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:143</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_klmn"></a>
Scalar Kalman filter</h1>
<p >The Kalman Filter is an efficient optimal estimator that provides a recursive computational methodology for getting the state of a signal from measurements that are typically noisy, while providing an estimate of the uncertainty of the estimate. Here, the scalar or one-dimensional version is provided and only three design parameters are required, the initial covariance \(P(0)\), the signal noise covariance \(Q\) and the measurement uncertainty \(r\).</p>
<p >The recursive equations used by this scalar version are:</p>
<p >predict</p>
<center> \( x(k) = Ax(k-1)\) </center><center> \( P(k) = A^{2}P(k-1) + Q\) </center><p >compute the Kalman gain</p>
<center> \( K(k) = \frac{P(k)H}{r + H P(k) H} \) </center><p >update the state and the state uncertainty</p>
<center> \( x(k) = x(k-1) + K(k)( u(k) - H x(k) ) \) </center><center> \( P(k) = ( 1 - K(k)H )P(k-1) \) </center><p >Where</p>
<p >\(A\) is the state transition model, \(H\) the observation model, \(x(k)\) the filter output (state estimation), \(P(k)\) the covariance of the predicted state, \(u(k)\) the signal measurement and \(K(k)\) the kalman gain.</p>
<h2><a class="anchor" id="qssmoother_ex9"></a>
Example: setting up a scalar Kalman filter:</h2>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structq_s_smoother___k_l_m_n__t.html">qSSmoother_KLMN_t</a>  smoother; </div>
<div class="line"><span class="keywordtype">float</span> param[] = { 100.0f, 100.0f, 9.0f }; <span class="comment">// [initial covariance, noise covariance, measurement uncertainty]</span></div>
<div class="line"><span class="keywordtype">int</span> ret;</div>
<div class="line"> </div>
<div class="line">ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ab3aa23be42e760981dfeb0dcce302b11">QSSMOOTHER_TYPE_KLMN</a>, param, NULL, 0u );</div>
<div class="line"><span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">    <span class="comment">// error, smooth filter cant be configured</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_gga8953f71916f57517edbe8cab4d7ee639ab3aa23be42e760981dfeb0dcce302b11"><div class="ttname"><a href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639ab3aa23be42e760981dfeb0dcce302b11">QSSMOOTHER_TYPE_KLMN</a></div><div class="ttdeci">@ QSSMOOTHER_TYPE_KLMN</div><div class="ttdef"><b>Definition:</b> qssmoother.h:36</div></div>
<div class="ttc" id="astructq_s_smoother___k_l_m_n__t_html"><div class="ttname"><a href="structq_s_smoother___k_l_m_n__t.html">qSSmoother_KLMN_t</a></div><div class="ttdoc">A scalar Kalman filter.</div><div class="ttdef"><b>Definition:</b> qssmoother.h:154</div></div>
</div><!-- fragment --><h1><a class="anchor" id="qssmoother_desf"></a>
Double Exponential Smoothing</h1>
<p >Is a time series forecasting technique used to analyze and predict trends in data. It is an extension of simple exponential smoothing that incorporates trend information into the forecast.</p>
<p >The double exponential smoothing filter calculates two smoothing coefficients, one for the level of the series and one for the trend. These coefficients are used to give more weight to recent observations and dampen the effect of older observations. The level and trend are then updated using the following equations:</p>
<p >Level: </p><center> \( L(t) = \alpha x(t) + ( 1 - \alpha ) [ L(t-1) + T(t-1) ] \) </center><p >Trend: </p><center> \( T(t) = \beta [ L(t-1) + T(t-1) ] + ( 1 - \beta ) T(t-1) \) </center><p >where \(\alpha\) and \(\beta\) are the smoothing coefficients for the level and trend, respectively.</p>
<p >The double exponential smoothing filter can be used to generate forecasts by extrapolating the level and trend components into the future. The forecast for time \(t+k\) is given by:</p>
<center> \( F(t+k) = L(t) + kT(t) \) </center><p >Where \(k\) is the number of time periods into the future.</p>
<p >Overall, double exponential smoothing is a simple but effective technique for forecasting time series data with trends. It can be easily implemented 3 and provides accurate forecasts for short-term predictions. However, it may not perform well for longer-term forecasts or for data with complex seasonal patterns.</p>
<h1><a class="anchor" id="qssmoother_alnf"></a>
Adaptive Linear Filter</h1>
<p >It is a digital filter that adjusts its parameters based on the characteristics of the input signal and the desired output signal.</p>
<p >The adaptive linear filter works by using an algorithm to iteratively adjust the filter coefficients in response to changes in the input signal \(x(t)\). The algorithm seeks to minimize the difference between the filter output and the desired output, known as the error signal \( e(t)\). This is done by adjusting the filter coefficients \(w_i(t)\) in the direction that reduces the error signal. For this, the Least Mean Squares (LMS) algorithm is being used. The LMS algorithm updates the filter coefficients by multiplying the error signal by the input signal and a small step size parameter, and then adding this product to the existing filter coefficients.</p>
<p >It is particularly useful in situations where the characteristics of the input signal are unknown or change over time, as it can adapt to these changes and continue to provide accurate filtering or modeling.</p>
<p >One potential drawback of the adaptive linear filter is that it can be computationally intensive, especially if the input signal is large or the filter has many coefficients. Additionally, the performance of the filter can be sensitive to the choice of step size parameter, which must be carefully chosen to balance convergence speed with stability.</p>
<p >The adaptation rule for every filter coefficient is given by </p><center> \( \Delta w(t) = \alpha e(t) x(t) + \mu \Delta w(t-1) \) </center><center> \( w(t) = w(t-1) x(t) + \Delta w(t) \) </center><p >The equation also includes a momentum term that adds a fraction of the previous coefficient update to the current coefficient update. This can help to reduce oscillations in the filter output and improve convergence speed.</p>
<h1><a class="anchor" id="qssmoother_ex10"></a>
Example of signal smoothing</h1>
<p >The following is an example of how a smoothing filter can be implemented. In this scenario, a Gaussian filter is used to smooth a speed sensor signal, reducing noise and improving overall signal quality. The filter is set up by defining the necessary parameters and instantiating the filter. The filter is then executed at a sampling rate of 100 milliseconds. This process involves sampling the signal and running it through the filter, resulting in a cleaned and enhanced signal that can be further processed without the need to account for noise and disturbances.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/FreeRTOS.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;freertos/task.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;bsp.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;qssmoother.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;AppSignalProcessing.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SMOOTHER_WINDOW_SIZE    ( 10 )</span></div>
<div class="line"><span class="preprocessor">#define SMOOTHER_SAMPLE_TIME    ( 100 )</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> xTaskSignalProcessing( <span class="keywordtype">void</span> *arg )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structq_s_smoother___g_m_w_f__t.html">qSSmoother_GMWF_t</a> *smoother = (<a class="code hl_struct" href="structq_s_smoother___g_m_w_f__t.html">qSSmoother_GMWF_t</a> *)arg;</div>
<div class="line">    <span class="keywordtype">float</span> noisySignal;</div>
<div class="line">    <span class="keywordtype">float</span> smoothedSignal;</div>
<div class="line">    <span class="keywordflow">for</span> ( ;; ) {</div>
<div class="line">        noisySignal = BSP_ScaletoSomething( BSP_AnalogRead( BSP_AI_SPEED_CHANNEL ) );</div>
<div class="line">        smoothedSignal = <a class="code hl_function" href="group__qssmoother.html#ga4b35d70416b5b24e1d894ac0c8b316eb">qSSmoother_Perform</a>( smoother, noisySignal );</div>
<div class="line">        AppSignalProcess( smoothedSignal );</div>
<div class="line">        vTaskDelay( SMOOTHER_SAMPLE_TIME / portTICK_RATE_MS ) ;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[] )</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="structq_s_smoother___g_m_w_f__t.html">qSSmoother_GMWF_t</a> smoother;</div>
<div class="line">    <span class="keywordtype">float</span> win_kernel[ 2*SMOOTHER_WINDOW_SIZE ]; <span class="comment">//storage for the window and the kernel</span></div>
<div class="line">    <span class="keywordtype">float</span> params[ 2 ] = { 0.5f, SMOOTHER_WINDOW_SIZE/2.0f }; <span class="comment">//sigma and offset</span></div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    </div>
<div class="line">    BSP_SystemInit( );</div>
<div class="line">    ret = <a class="code hl_function" href="group__qssmoother.html#gae494958fd1353a8cd956e35abd6641f7">qSSmoother_Setup</a>( &amp;smoother, <a class="code hl_enumvalue" href="group__qssmoother.html#gga8953f71916f57517edbe8cab4d7ee639a0f072f41aec7b912c7e49bf897a0d87b">QSSMOOTHER_TYPE_GMWF</a>, params, win_kernel, <span class="keyword">sizeof</span>(win_kernel)/<span class="keyword">sizeof</span>(win_kernel[0]) );</div>
<div class="line">    <span class="keywordflow">if</span> ( 0 == ret ) {</div>
<div class="line">        puts( <span class="stringliteral">&quot;ERROR: Cant configure the smoother filter&quot;</span> );</div>
<div class="line">    }</div>
<div class="line">    xTaskCreate( xTaskSignalProcessing, <span class="stringliteral">&quot;signalProcessing&quot;</span>, 512, &amp;smoother, 2, NULL );</div>
<div class="line">    vTaskStartScheduler();</div>
<div class="line">    <span class="keywordflow">for</span>( ;; );</div>
<div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__qssmoother_html_ga4b35d70416b5b24e1d894ac0c8b316eb"><div class="ttname"><a href="group__qssmoother.html#ga4b35d70416b5b24e1d894ac0c8b316eb">qSSmoother_Perform</a></div><div class="ttdeci">float qSSmoother_Perform(qSSmootherPtr_t *const s, const float x)</div><div class="ttdoc">Perform the smooth operation recursively for the input signal x.</div><div class="ttdef"><b>Definition:</b> qssmoother.c:459</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">qLibs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
